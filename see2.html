<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SparkTopo - AI Chat Interface</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'thai': ['Inter', 'Noto Sans Thai', 'sans-serif']
                    },
                    colors: {
                        'spark-dark': '#0a0a0a',
                        'spark-gray': '#1a1a1a',
                        'spark-light': '#2a2a2a',
                        'spark-border': '#333333',
                        'spark-text': '#e5e7eb'
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+Thai:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        *::-webkit-scrollbar {
            display: none;
        }
        
        html {
            scroll-behavior: smooth;
            -webkit-text-size-adjust: 100%;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        body {
            overscroll-behavior: none;
            -webkit-overflow-scrolling: touch;
        }
        
        .typing-dots {
            animation: typing 1.4s infinite ease-in-out;
        }
        .typing-dots:nth-child(1) { animation-delay: 0s; }
        .typing-dots:nth-child(2) { animation-delay: 0.2s; }
        .typing-dots:nth-child(3) { animation-delay: 0.4s; }
        
        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); opacity: 0.4; }
            30% { transform: translateY(-10px); opacity: 1; }
        }
        
        .message-slide-in {
            animation: slideInUp 0.3s ease-out;
        }
        
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(15px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .hover-lift {
            transition: all 0.2s ease;
        }
        .hover-lift:hover {
            transform: translateY(-1px);
        }
        
        .menu-dropdown {
            transform: translateY(-10px);
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s ease;
        }
        
        .menu-dropdown.show {
            transform: translateY(0);
            opacity: 1;
            visibility: visible;
        }
        
        .copy-popup {
            transform: translateY(10px);
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s ease;
        }
        
        .copy-popup.show {
            transform: translateY(0);
            opacity: 1;
            visibility: visible;
        }
        
        .page-transition {
            transition: transform 0.3s ease-in-out;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .slide-left {
            transform: translateX(-100%);
        }

        .slide-right {
            transform: translateX(100%);
        }

        .page-active {
            transform: translateX(0);
        }

        .online-indicator {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .typing-cursor {
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        .mobile-safe-area {
            height: 100vh;
            height: 100dvh;
            min-height: -webkit-fill-available;
            min-height: fill-available;
        }
        
        @supports (-webkit-touch-callout: none) {
            .mobile-safe-area {
                height: -webkit-fill-available;
            }
        }

        .fixed-input-area {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 50;
            background: #1a1a1a;
            border-top: 1px solid #333333;
            padding: 1rem;
            padding-bottom: max(1.5rem, env(safe-area-inset-bottom));
        }

        .chat-with-fixed-input {
            padding-bottom: 140px;
        }

        @media (max-height: 600px) {
            .fixed-input-area {
                padding: 0.75rem;
                padding-bottom: max(1rem, env(safe-area-inset-bottom));
            }
            .chat-with-fixed-input {
                padding-bottom: 100px;
            }
        }
    </style>
</head>
<body class="bg-spark-dark text-spark-text font-thai antialiased">
    <div class="flex flex-col mobile-safe-area w-full bg-spark-gray overflow-hidden relative">
        
        <div id="chatPage" class="flex flex-col h-full page-transition page-active">
            <header class="bg-black px-6 py-4 flex items-center justify-between shadow-lg border-b border-gray-800">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-white rounded-full flex items-center justify-center shadow-md">
                        <svg class="w-6 h-6 text-black" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 2L13.09 8.26L22 9L13.09 9.74L12 16L10.91 9.74L2 9L10.91 8.26L12 2Z"/>
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-white tracking-wide">SparkTopo AI</h1>
                        <div class="flex items-center space-x-2">
                            <div class="w-2 h-2 bg-green-400 rounded-full online-indicator"></div>
                            <span class="text-xs text-green-300">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏ä‡∏ó</span>
                        </div>
                    </div>
                </div>
                
                <div class="relative">
                    <button id="menuButton" class="p-2 hover:bg-gray-800 rounded-xl transition-all hover-lift text-white">
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z"/>
                        </svg>
                    </button>
                    
                    <div id="menuDropdown" class="menu-dropdown absolute right-0 top-12 bg-white border border-gray-200 rounded-xl shadow-xl w-48 py-2 z-50">
                        <button id="resetChat" class="reset-btn w-full px-4 py-2 text-left hover:bg-gray-100 transition-colors flex items-center space-x-3 text-gray-700 disabled:opacity-50 disabled:cursor-not-allowed">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                            </svg>
                            <span>‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÅ‡∏ä‡∏ó</span>
                        </button>
                        <button id="chatHistory" class="w-full px-4 py-2 text-left hover:bg-gray-100 transition-colors flex items-center space-x-3 text-gray-700">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            <span>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÅ‡∏ä‡∏ó</span>
                        </button>
                    </div>
                </div>
            </header>

            <div class="flex-1 flex flex-col min-h-0">
                <div id="chatContainer" class="flex-1 overflow-y-auto flex flex-col space-y-4 px-6 pt-6 chat-with-fixed-input">
                    <div class="flex justify-start message-slide-in">
                        <div class="max-w-xs md:max-w-md relative group">
                            <div class="bg-gray-800 rounded-3xl rounded-tl-lg px-5 py-4 shadow-lg border border-gray-700">
                                <p class="text-white leading-relaxed">
                                    ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà SparkTopo! üöÄ<br>
                                    ‡∏ú‡∏°‡∏Ñ‡∏∑‡∏≠ AI Assistant ‡∏ó‡∏µ‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á<br>
                                    ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏ô‡∏ó‡∏ô‡∏≤‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö
                                </p>
                            </div>
                            <div class="flex items-center space-x-2 mt-2 opacity-0 group-hover:opacity-100 transition-opacity">
                                <button class="ai-copy-btn p-1 hover:bg-gray-700 rounded transition-colors" data-message="‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà SparkTopo! ‡∏ú‡∏°‡∏Ñ‡∏∑‡∏≠ AI Assistant ‡∏ó‡∏µ‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏ô‡∏ó‡∏ô‡∏≤‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö">
                                    <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                                    </svg>
                                </button>
                                <button class="ai-feedback-btn p-1 hover:bg-gray-700 rounded transition-colors">
                                    <svg class="w-4 h-4 text-gray-400 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="historyPage" class="flex flex-col h-full page-transition slide-right">
            <header class="bg-gray-900 px-6 py-4 flex items-center justify-between shadow-lg border-b border-gray-700">
                <div class="flex items-center space-x-3">
                    <button id="backToChat" class="p-2 hover:bg-gray-700 rounded-xl transition-all hover-lift text-white">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/>
                        </svg>
                    </button>
                    <div>
                        <h1 class="text-xl font-bold text-white tracking-wide">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏ô‡∏ó‡∏ô‡∏≤</h1>
                        <p class="text-xs text-gray-400">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ä‡∏ó‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏î‡∏π</p>
                    </div>
                </div>
                
                <button id="clearAllHistory" class="text-red-400 hover:text-white hover:bg-red-500 transition p-2 rounded-xl disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-transparent disabled:hover:text-red-400">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                    </svg>
                </button>
            </header>

            <div id="historyList" class="flex-1 overflow-y-auto px-6 py-6"></div>
        </div>

        <div id="chatDetailPage" class="flex flex-col h-full page-transition slide-right">
            <header class="bg-gray-800 px-6 py-4 flex items-center justify-between shadow-lg border-b border-gray-600">
                <div class="flex items-center space-x-3">
                    <button id="backToHistory" class="p-2 hover:bg-gray-600 rounded-xl transition-all hover-lift text-white">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/>
                        </svg>
                    </button>
                    <div>
                        <h1 class="text-xl font-bold text-white tracking-wide">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÅ‡∏ä‡∏ó</h1>
                        <span id="chatDetailTime" class="text-xs text-gray-400"></span>
                    </div>
                </div>
            </header>

            <div id="chatDetailContent" class="flex-1 overflow-y-auto px-6 py-6 space-y-4"></div>
        </div>

        <div id="inputArea" class="fixed-input-area">
            <div id="attachedFilesContainer" class="hidden flex flex-wrap gap-2 mb-3"></div>
            
            <div class="flex items-center space-x-3">
                <button id="attachButton" class="text-gray-400 hover:text-white transition p-3 hover:scale-110 transform flex-shrink-0 hover:bg-gray-700 rounded-xl">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                    </svg>
                </button>
                
                <div class="flex-1 relative">
                    <textarea 
                        id="messageInput"
                        placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°..."
                        class="w-full bg-black border-2 border-gray-700 rounded-2xl px-5 py-4 text-white placeholder-gray-500 focus:outline-none focus:border-gray-500 transition resize-none min-h-[56px] overflow-hidden font-medium"
                        rows="1"
                    ></textarea>
                </div>
                
                <button 
                    id="sendButton" 
                    class="bg-gray-700 text-gray-500 opacity-50 p-4 rounded-full transition hover:scale-110 transform active:scale-95 flex-shrink-0 disabled:opacity-50 disabled:cursor-not-allowed shadow-lg"
                    disabled
                >
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <div id="copyPopup" class="copy-popup fixed top-20 left-1/2 transform -translate-x-1/2 bg-gray-800 border border-gray-600 rounded-xl px-4 py-2 shadow-xl z-50">
        <div class="flex items-center space-x-2">
            <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/>
            </svg>
            <span class="text-white text-sm font-medium">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß</span>
        </div>
    </div>

                                                                                    </svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                }
            }).join('');
            
            this.chatDetailContent.innerHTML = `<div class="space-y-4">${messagesHtml}</div>`;
        }

        clearAllChatHistory() {
            if (this.chatHistoryData.length === 0) return;
            
            this.showCustomConfirm(
                '‡∏•‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏ô‡∏ó‡∏ô‡∏≤',
                '‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏ô‡∏ó‡∏ô‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà? ‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏î‡πâ',
                () => {
                    this.chatHistoryData = [];
                    this.saveChatHistory();
                    this.populateHistoryList();
                    this.updateClearHistoryButtonState();
                }
            );
        }

        resetChatHistory() {
            if (this.currentChatSession.length === 0) return;
            
            this.saveSessionToHistory();
            
            this.currentChatSession = [];
            this.sessionId = Date.now();
            localStorage.removeItem('sparkTopo_currentSession');
            
            this.chatContainer.innerHTML = `
                <div class="flex justify-start message-slide-in">
                    <div class="max-w-xs md:max-w-md relative group">
                        <div class="bg-gray-800 rounded-3xl rounded-tl-lg px-5 py-4 shadow-lg border border-gray-700">
                            <p class="text-white leading-relaxed">
                                ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà SparkTopo! üöÄ<br>
                                ‡∏ú‡∏°‡∏Ñ‡∏∑‡∏≠ AI Assistant ‡∏ó‡∏µ‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á<br>
                                ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏ô‡∏ó‡∏ô‡∏≤‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö
                            </p>
                        </div>
                        <div class="flex items-center space-x-2 mt-2 opacity-0 group-hover:opacity-100 transition-opacity">
                            <button class="ai-copy-btn p-1 hover:bg-gray-700 rounded transition-colors" data-message="‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà SparkTopo! ‡∏ú‡∏°‡∏Ñ‡∏∑‡∏≠ AI Assistant ‡∏ó‡∏µ‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏ô‡∏ó‡∏ô‡∏≤‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö">
                                <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                                </svg>
                            </button>
                            <button class="ai-feedback-btn p-1 hover:bg-gray-700 rounded transition-colors">
                                <svg class="w-4 h-4 text-gray-400 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>

           <script>
               class SparkTopoChat {
    constructor() {
        this.initializeElements();
        this.initializeState();
        this.createFileInput();
        this.initializeEventListeners();
        this.autoResizeTextarea();
        this.updateSendButtonState();
        this.handleMobileViewport();
        this.loadCurrentSessionToChat();
        this.updateClearHistoryButtonState(); // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
    }

    initializeElements() {
        this.chatContainer = document.getElementById('chatContainer');
        this.messageInput = document.getElementById('messageInput');
        this.sendButton = document.getElementById('sendButton');
        this.attachButton = document.getElementById('attachButton');
        this.menuButton = document.getElementById('menuButton');
        this.menuDropdown = document.getElementById('menuDropdown');
        this.resetChat = document.getElementById('resetChat');
        this.chatHistory = document.getElementById('chatHistory');
        this.copyPopup = document.getElementById('copyPopup');
        
        this.chatPage = document.getElementById('chatPage');
        this.historyPage = document.getElementById('historyPage');
        this.chatDetailPage = document.getElementById('chatDetailPage');
        this.historyList = document.getElementById('historyList');
        this.chatDetailContent = document.getElementById('chatDetailContent');
        this.chatDetailTime = document.getElementById('chatDetailTime');
        
        this.backToChat = document.getElementById('backToChat');
        this.backToHistory = document.getElementById('backToHistory');
        this.clearAllHistory = document.getElementById('clearAllHistory');
        this.attachedFilesContainer = document.getElementById('attachedFilesContainer');
    }

    initializeState() {
        this.isTyping = false;
        this.chatHistoryData = this.loadChatHistory();
        this.currentPage = 'chat';
        this.attachedFiles = [];
        this.currentChatSession = this.loadCurrentSession();
        // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ session ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ sessionId ‡πÄ‡∏î‡∏¥‡∏° ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ
        this.sessionId = this.currentChatSession.length > 0 ? this.currentChatSession[0].sessionId : Date.now(); 
    }

    createFileInput() {
        this.fileInput = document.createElement('input');
        this.fileInput.type = 'file';
        this.fileInput.multiple = false;
        this.fileInput.accept = 'image/*'; // ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÅ‡∏Ñ‡πà‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
        this.fileInput.style.display = 'none';
        document.body.appendChild(this.fileInput);
        
        this.fileInput.addEventListener('change', (e) => this.handleFileSelect(e));
    }

    handleMobileViewport() {
        const handleResize = () => {
            const vh = window.innerHeight * 0.01;
            document.documentElement.style.setProperty('--vh', `${vh}px`);
        };

        window.addEventListener('resize', handleResize);
        window.addEventListener('orientationchange', handleResize);
        handleResize();

        // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö iOS ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤ Safe Area ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
        if (/iPad|iPhone|iPod/.test(navigator.userAgent)) {
            document.body.style.paddingBottom = 'env(safe-area-inset-bottom)';
        }
    }

    updateSendButtonState() {
        const hasText = this.messageInput.value.trim().length > 0;
        const hasFiles = this.attachedFiles.length > 0;
        const canSend = (hasText || hasFiles) && !this.isTyping;
        
        this.sendButton.disabled = !canSend;
        
        if (canSend) {
            this.sendButton.classList.remove('opacity-50', 'bg-gray-700', 'text-gray-500');
            this.sendButton.classList.add('bg-white', 'text-black', 'shadow-lg');
        } else {
            this.sendButton.classList.add('opacity-50', 'bg-gray-700', 'text-gray-500');
            this.sendButton.classList.remove('bg-white', 'text-black', 'shadow-lg');
        }
    }

    initializeEventListeners() {
        this.sendButton.addEventListener('click', () => this.sendMessage());
        this.messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) { // ‡∏Å‡∏î Enter ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° ‡πÅ‡∏ï‡πà Shift+Enter ‡∏Ç‡∏∂‡πâ‡∏ô‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÉ‡∏´‡∏°‡πà
                e.preventDefault();
                this.sendMessage();
            }
        });
        this.messageInput.addEventListener('input', () => {
            this.autoResizeTextarea();
            this.updateSendButtonState();
        });
        this.attachButton.addEventListener('click', () => this.fileInput.click());
        this.menuButton.addEventListener('click', () => this.toggleMenu());
        this.resetChat.addEventListener('click', () => this.confirmResetChat());
        this.chatHistory.addEventListener('click', () => this.showHistoryPage());
        this.backToChat.addEventListener('click', () => this.showChatPage());
        this.backToHistory.addEventListener('click', () => this.showHistoryPage());
        this.clearAllHistory.addEventListener('click', () => this.confirmClearHistory());
        
        // ‡∏õ‡∏¥‡∏î‡πÄ‡∏°‡∏ô‡∏π‡∏î‡∏£‡∏≠‡∏õ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ô‡∏≠‡∏Å‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà
        document.addEventListener('click', (e) => {
            if (!this.menuDropdown.contains(e.target) && !this.menuButton.contains(e.target) && this.menuDropdown.classList.contains('show')) {
                this.toggleMenu();
            }
        });

        // Event delegation ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡∏∞‡∏õ‡∏∏‡πà‡∏° Feedback (‡∏´‡∏±‡∏ß‡πÉ‡∏à)
        this.chatContainer.addEventListener('click', (e) => {
            if (e.target.closest('.ai-copy-btn')) {
                const btn = e.target.closest('.ai-copy-btn');
                const messageToCopy = btn.dataset.message;
                this.copyToClipboard(messageToCopy);
            }
            if (e.target.closest('.ai-feedback-btn')) {
                // ‡πÉ‡∏™‡πà logic ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö feedback ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ (‡πÄ‡∏ä‡πà‡∏ô ‡πÅ‡∏™‡∏î‡∏á modal ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•)
                console.log('Feedback button clicked!');
                const heartIcon = e.target.closest('.ai-feedback-btn').querySelector('svg path');
                if (heartIcon) {
                    heartIcon.setAttribute('fill', 'currentColor'); // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ‡∏´‡∏±‡∏ß‡πÉ‡∏à‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡πÄ‡∏ï‡πá‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡πà‡∏á‡∏ö‡∏≠‡∏Å‡∏ß‡πà‡∏≤‡∏Å‡∏î‡πÑ‡∏•‡∏Ñ‡πå‡πÅ‡∏•‡πâ‡∏ß
                    heartIcon.classList.add('text-red-400'); // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏µ‡πÅ‡∏î‡∏á (‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£)
                }
            }
        });

        // Event delegation ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡∏•‡∏¥‡∏Å‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÅ‡∏ä‡∏ó
        this.historyList.addEventListener('click', (e) => {
            const chatItem = e.target.closest('.chat-history-item');
            if (chatItem) {
                const sessionId = chatItem.dataset.sessionId;
                this.showChatDetailPage(sessionId);
            }
        });
    }

    toggleMenu() {
        this.menuDropdown.classList.toggle('show');
    }

    confirmResetChat() {
        if (confirm('‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Å‡∏≤‡∏£‡∏™‡∏ô‡∏ó‡∏ô‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô? ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏ô‡∏ó‡∏ô‡∏≤‡∏à‡∏∞‡∏´‡∏≤‡∏¢‡πÑ‡∏õ')) {
            this.resetCurrentChatSession();
            this.toggleMenu(); // ‡∏õ‡∏¥‡∏î‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£
        }
    }

    confirmClearHistory() {
        if (confirm('‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏ô‡∏ó‡∏ô‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î? ‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏î‡πâ')) {
            this.clearAllChatHistory();
            this.showHistoryPage(); // ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥
        }
    }

    resetCurrentChatSession() {
        this.currentChatSession = [];
        this.saveCurrentSession();
        this.chatContainer.innerHTML = `
            <div class="flex justify-start message-slide-in mt-4"> <div class="max-w-xs md:max-w-md relative group">
                    <div class="bg-gray-800 rounded-3xl rounded-tl-lg px-5 py-4 shadow-lg border border-gray-700">
                        <p class="text-white leading-relaxed">
                            ‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö! ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà SparkTopo AI üåü<br>
                            ‡∏ú‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÅ‡∏•‡∏∞‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì<br>
                            ‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡πÉ‡∏´‡πâ‡∏ä‡πà‡∏ß‡∏¢‡πÑ‡∏´‡∏°‡∏Ñ‡∏£‡∏±‡∏ö?
                        </p>
                    </div>
                    <div class="flex items-center space-x-2 mt-2 opacity-0 group-hover:opacity-100 transition-opacity">
                        <button class="ai-copy-btn p-1 hover:bg-gray-700 rounded transition-colors" data-message="‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö! ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà SparkTopo AI ‡∏ú‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÅ‡∏•‡∏∞‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡πÉ‡∏´‡πâ‡∏ä‡πà‡∏ß‡∏¢‡πÑ‡∏´‡∏°‡∏Ñ‡∏£‡∏±‡∏ö?">
                            <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                            </svg>
                        </button>
                        <button class="ai-feedback-btn p-1 hover:bg-gray-700 rounded transition-colors">
                            <svg class="w-4 h-4 text-gray-400 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        `;
        this.sessionId = Date.now(); // ‡∏™‡∏£‡πâ‡∏≤‡∏á session ID ‡πÉ‡∏´‡∏°‡πà
        this.saveChatHistory(); // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏î‡πâ‡∏ß‡∏¢ session ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏•‡πâ‡∏≤‡∏á
        this.updateClearHistoryButtonState();
        this.scrollToBottom();
    }

    clearAllChatHistory() {
        localStorage.removeItem('chatHistory');
        this.chatHistoryData = [];
        this.updateHistoryList();
        this.updateClearHistoryButtonState();
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ä‡πà‡∏ß‡∏¢‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏ô‡πâ‡∏≤
    showPage(pageId) {
        this.chatPage.classList.remove('page-active', 'slide-left', 'slide-right');
        this.historyPage.classList.remove('page-active', 'slide-left', 'slide-right');
        this.chatDetailPage.classList.remove('page-active', 'slide-left', 'slide-right');

        if (pageId === 'chat') {
            this.chatPage.classList.add('page-active');
            this.currentPage = 'chat';
        } else if (pageId === 'history') {
            this.historyPage.classList.add('page-active');
            this.currentPage = 'history';
        } else if (pageId === 'chatDetail') {
            this.chatDetailPage.classList.add('page-active');
            this.currentPage = 'chatDetail';
        }
    }

    showChatPage() {
        this.showPage('chat');
        this.toggleMenu(); // ‡∏õ‡∏¥‡∏î‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏ä‡∏ó
        this.scrollToBottom();
    }

    showHistoryPage() {
        this.updateHistoryList(); // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡πà‡∏≠‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤
        this.showPage('history');
        this.toggleMenu(); // ‡∏õ‡∏¥‡∏î‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥
    }

    showChatDetailPage(sessionId) {
        const session = this.chatHistoryData.find(s => s.sessionId == sessionId);
        if (!session) {
            console.error('Session not found:', sessionId);
            return;
        }

        this.chatDetailContent.innerHTML = ''; // ‡∏•‡πâ‡∏≤‡∏á‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÄ‡∏î‡∏¥‡∏°
        this.chatDetailTime.textContent = new Date(session.sessionId).toLocaleString('th-TH', { dateStyle: 'medium', timeStyle: 'short' });

        session.messages.forEach(msg => {
            const messageElement = document.createElement('div');
            messageElement.classList.add('flex', 'message-slide-in', 'mt-4'); // ‡πÄ‡∏û‡∏¥‡πà‡∏° mt-4 ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡∏î‡πâ‡∏ß‡∏¢

            if (msg.sender === 'user') {
                messageElement.classList.add('justify-end');
                messageElement.innerHTML = `
                    <div class="max-w-xs md:max-w-md bg-white text-gray-900 rounded-3xl rounded-br-lg px-5 py-4 shadow-lg border border-gray-200">
                        <p class="leading-relaxed">${this.formatMessageContent(msg.content)}</p>
                    </div>
                `;
            } else {
                messageElement.classList.add('justify-start');
                messageElement.innerHTML = `
                    <div class="max-w-xs md:max-w-md relative group">
                        <div class="bg-gray-800 rounded-3xl rounded-tl-lg px-5 py-4 shadow-lg border border-gray-700">
                            <p class="text-white leading-relaxed">${this.formatMessageContent(msg.content)}</p>
                        </div>
                        <div class="flex items-center space-x-2 mt-2 opacity-0 group-hover:opacity-100 transition-opacity">
                            <button class="ai-copy-btn p-1 hover:bg-gray-700 rounded transition-colors" data-message="${msg.content.replace(/"/g, '&quot;')}">
                                <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                                </svg>
                            </button>
                            <button class="ai-feedback-btn p-1 hover:bg-gray-700 rounded transition-colors">
                                <svg class="w-4 h-4 text-gray-400 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                `;
            }
            this.chatDetailContent.appendChild(messageElement);
        });
        this.showPage('chatDetail');
        this.chatDetailContent.scrollTop = this.chatDetailContent.scrollHeight; // ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏õ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
    }

    updateHistoryList() {
        this.historyList.innerHTML = '';
        if (this.chatHistoryData.length === 0) {
            this.historyList.innerHTML = `
                <div class="text-center text-gray-500 py-10">
                    <p class="text-lg mb-2">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏ô‡∏ó‡∏ô‡∏≤</p>
                    <p class="text-sm">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏™‡∏ô‡∏ó‡∏ô‡∏≤‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</p>
                </div>
            `;
            this.clearAllHistory.disabled = true; // ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏õ‡∏∏‡πà‡∏°‡∏•‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥
            this.clearAllHistory.classList.add('opacity-50', 'cursor-not-allowed', 'hover:bg-transparent', 'hover:text-red-400');
            return;
        }

        this.clearAllHistory.disabled = false; // ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏õ‡∏∏‡πà‡∏°‡∏•‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥
        this.clearAllHistory.classList.remove('opacity-50', 'cursor-not-allowed', 'hover:bg-transparent', 'hover:text-red-400');

        // ‡∏à‡∏±‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÇ‡∏î‡∏¢ sessionId (‡∏ã‡∏∂‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô timestamp) ‡∏à‡∏≤‡∏Å‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏õ‡πÄ‡∏Å‡πà‡∏≤
        const sortedHistory = [...this.chatHistoryData].sort((a, b) => b.sessionId - a.sessionId);

        sortedHistory.forEach(session => {
            const firstUserMessage = session.messages.find(msg => msg.sender === 'user');
            const previewText = firstUserMessage ? firstUserMessage.content.substring(0, 50) + (firstUserMessage.content.length > 50 ? '...' : '') : '‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏™‡∏ô‡∏ó‡∏ô‡∏≤...';
            const timestamp = new Date(session.sessionId).toLocaleString('th-TH', { dateStyle: 'medium', timeStyle: 'short' });

            const historyItem = document.createElement('button');
            historyItem.classList.add('chat-history-item', 'w-full', 'px-5', 'py-4', 'bg-spark-light', 'rounded-xl', 'text-left', 'hover:bg-gray-700', 'transition-all', 'hover-lift', 'shadow-lg', 'mb-4', 'flex', 'flex-col', 'gap-1');
            historyItem.dataset.sessionId = session.sessionId;
            historyItem.innerHTML = `
                <span class="text-white text-base font-medium">${previewText}</span>
                <span class="text-gray-400 text-xs">${timestamp}</span>
            `;
            this.historyList.appendChild(historyItem);
        });
    }

    updateClearHistoryButtonState() {
        if (this.chatHistoryData.length === 0) {
            this.clearAllHistory.disabled = true;
            this.clearAllHistory.classList.add('opacity-50', 'cursor-not-allowed', 'hover:bg-transparent', 'hover:text-red-400');
        } else {
            this.clearAllHistory.disabled = false;
            this.clearAllHistory.classList.remove('opacity-50', 'cursor-not-allowed', 'hover:bg-transparent', 'hover:text-red-400');
        }
    }

    sendMessage() {
        const messageText = this.messageInput.value.trim();
        const filesToSend = [...this.attachedFiles]; // ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å array ‡∏Ç‡∏≠‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡∏µ‡πâ

        if (!messageText && filesToSend.length === 0) {
            return; // ‡πÑ‡∏°‡πà‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ó‡∏±‡πâ‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏•‡∏∞‡πÑ‡∏ü‡∏•‡πå
        }

        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
        this.appendMessage('user', messageText, filesToSend);
        this.currentChatSession.push({ sender: 'user', content: messageText, files: filesToSend.map(f => f.name) }); // ‡πÄ‡∏Å‡πá‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå
        this.saveCurrentSession();
        this.scrollToBottom();

        this.messageInput.value = ''; // ‡∏•‡πâ‡∏≤‡∏á‡∏ä‡πà‡∏≠‡∏á input
        this.attachedFiles = []; // ‡∏•‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏ö‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏™‡πà‡∏á
        this.attachedFilesContainer.innerHTML = '';
        this.attachedFilesContainer.classList.add('hidden');
        this.updateSendButtonState();
        this.autoResizeTextarea();

        // ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏Ç‡∏≠‡∏á AI
        this.showTypingIndicator();
        setTimeout(() => {
            const aiResponseContent = `‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì "${messageText}"${filesToSend.length > 0 ? ' ‡πÅ‡∏•‡∏∞‡πÑ‡∏ü‡∏•‡πå ' + filesToSend.map(f => f.name).join(', ') : ''} ‡∏Ñ‡∏£‡∏±‡∏ö. ‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡πÉ‡∏´‡πâ‡∏â‡∏±‡∏ô‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏≠‡∏µ‡∏Å‡πÑ‡∏´‡∏°‡∏Ñ‡∏£‡∏±‡∏ö?`;
            this.removeTypingIndicator();
            this.appendMessage('ai', aiResponseContent);
            this.currentChatSession.push({ sender: 'ai', content: aiResponseContent });
            this.saveCurrentSession();
            this.scrollToBottom();
            this.saveChatHistory(); // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å AI ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤ session ‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå
        }, 1500); // ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å 1.5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
    }

    appendMessage(sender, content, files = []) {
        const messageElement = document.createElement('div');
        // *** ‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡πÄ‡∏û‡∏¥‡πà‡∏° mt-4 ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏°‡∏µ‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏™‡∏°‡πà‡∏≥‡πÄ‡∏™‡∏°‡∏≠ ***
        messageElement.classList.add('flex', 'message-slide-in', 'mt-4'); 

        if (sender === 'user') {
            messageElement.classList.add('justify-end'); // ‡∏à‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏õ‡∏ó‡∏≤‡∏á‡∏Ç‡∏ß‡∏≤
            let filePreviewHTML = '';
            if (files.length > 0) {
                filePreviewHTML = files.map(file => {
                    const objectURL = URL.createObjectURL(file); // ‡∏™‡∏£‡πâ‡∏≤‡∏á URL ‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏†‡∏≤‡∏û
                    return `<img src="${objectURL}" class="max-w-[150px] max-h-[150px] rounded-lg mt-2 object-cover" onload="URL.revokeObjectURL(this.src);">`;
                }).join('');
            }
            messageElement.innerHTML = `
                <div class="max-w-xs md:max-w-md bg-white text-gray-900 rounded-3xl rounded-br-lg px-5 py-4 shadow-lg border border-gray-200">
                    <p class="leading-relaxed">${this.formatMessageContent(content)}</p>
                    ${filePreviewHTML ? `<div class="mt-2 flex flex-wrap gap-2">${filePreviewHTML}</div>` : ''}
                </div>
            `;
        } else {
            messageElement.classList.add('justify-start'); // ‡∏à‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° AI ‡πÑ‡∏õ‡∏ó‡∏≤‡∏á‡∏ã‡πâ‡∏≤‡∏¢
            messageElement.innerHTML = `
                <div class="max-w-xs md:max-w-md relative group">
                    <div class="bg-gray-800 rounded-3xl rounded-tl-lg px-5 py-4 shadow-lg border border-gray-700">
                        <p class="text-white leading-relaxed">${this.formatMessageContent(content)}</p>
                    </div>
                    <div class="flex items-center space-x-2 mt-2 opacity-0 group-hover:opacity-100 transition-opacity">
                    <button class="ai-copy-btn p-1 hover:bg-gray-700 rounded transition-colors" data-message="${content.replace(/"/g, '&quot;')}">
                            <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                            </svg>
                        </button>
                        <button class="ai-feedback-btn p-1 hover:bg-gray-700 rounded transition-colors">
                            <svg class="w-4 h-4 text-gray-400 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                            </svg>
                        </button>
                    </div>
                </div>
            `;
        }
        this.chatContainer.appendChild(messageElement);
        this.scrollToBottom();
    }

    showTypingIndicator() {
        if (document.getElementById('typingIndicator')) return; // ‡πÑ‡∏°‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ã‡πâ‡∏≥‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß

        const typingIndicatorElement = document.createElement('div');
        typingIndicatorElement.id = 'typingIndicator';
        // *** ‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡πÄ‡∏û‡∏¥‡πà‡∏° mt-4 ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡∏î‡πâ‡∏ß‡∏¢ ***
        typingIndicatorElement.classList.add('flex', 'justify-start', 'message-slide-in', 'mt-4'); 
        typingIndicatorElement.innerHTML = `
            <div class="bg-gray-800 rounded-3xl rounded-tl-lg px-5 py-4 shadow-lg border border-gray-700 flex items-center space-x-2">
                <span class="typing-dots w-2 h-2 bg-gray-400 rounded-full"></span>
                <span class="typing-dots w-2 h-2 bg-gray-400 rounded-full"></span>
                <span class="typing-dots w-2 h-2 bg-gray-400 rounded-full"></span>
            </div>
        `;
        this.chatContainer.appendChild(typingIndicatorElement);
        this.scrollToBottom();
        this.isTyping = true;
        this.updateSendButtonState();
    }

    removeTypingIndicator() {
        const typingIndicatorElement = document.getElementById('typingIndicator');
        if (typingIndicatorElement) {
            typingIndicatorElement.remove();
        }
        this.isTyping = false;
        this.updateSendButtonState();
    }

    scrollToBottom() {
        this.chatContainer.scrollTop = this.chatContainer.scrollHeight;
    }

    autoResizeTextarea() {
        this.messageInput.style.height = 'auto';
        this.messageInput.style.height = this.messageInput.scrollHeight + 'px';
    }

    loadCurrentSessionToChat() {
        this.chatContainer.innerHTML = ''; // ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÄ‡∏î‡∏¥‡∏°
        if (this.currentChatSession.length > 0) {
            this.currentChatSession.forEach(msg => {
                this.appendMessage(msg.sender, msg.content, msg.files || []); // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤‡∏™‡πà‡∏á array ‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢
            });
        } else {
            // ‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏°‡∏µ session ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
            this.appendMessage('ai', '‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö! ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà SparkTopo AI üåü<br>‡∏ú‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÅ‡∏•‡∏∞‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì<br>‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡πÉ‡∏´‡πâ‡∏ä‡πà‡∏ß‡∏¢‡πÑ‡∏´‡∏°‡∏Ñ‡∏£‡∏±‡∏ö?');
        }
        this.scrollToBottom();
    }

    saveCurrentSession() {
        localStorage.setItem('currentChatSession', JSON.stringify(this.currentChatSession));
    }

    loadCurrentSession() {
        const storedSession = localStorage.getItem('currentChatSession');
        return storedSession ? JSON.parse(storedSession) : [];
    }

    saveChatHistory() {
        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤ session ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡πá‡∏ï‡πà‡∏≠‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤
        if (this.currentChatSession.length > 0) {
            const existingSessionIndex = this.chatHistoryData.findIndex(s => s.sessionId === this.sessionId);
            const sessionToSave = {
                sessionId: this.sessionId,
                messages: this.currentChatSession
            };

            if (existingSessionIndex > -1) {
                // ‡∏ñ‡πâ‡∏≤ session ‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß ‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï
                this.chatHistoryData[existingSessionIndex] = sessionToSave;
            } else {
                // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô session ‡πÉ‡∏´‡∏°‡πà ‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ
                this.chatHistoryData.push(sessionToSave);
            }
        }
        localStorage.setItem('chatHistory', JSON.stringify(this.chatHistoryData));
    }

    loadChatHistory() {
        const storedHistory = localStorage.getItem('chatHistory');
        return storedHistory ? JSON.parse(storedHistory) : [];
    }

    formatMessageContent(content) {
        // ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≤‡∏£‡∏Ç‡∏∂‡πâ‡∏ô‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÉ‡∏´‡∏°‡πà‡∏î‡πâ‡∏ß‡∏¢ <br> ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• HTML
        return content.replace(/\n/g, '<br>');
    }

    copyToClipboard(text) {
        navigator.clipboard.writeText(text).then(() => {
            this.showCopyPopup();
        }).catch(err => {
            console.error('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏î‡πâ: ', err);
        });
    }

    showCopyPopup() {
        this.copyPopup.classList.add('show');
        setTimeout(() => {
            this.copyPopup.classList.remove('show');
        }, 1500); // ‡∏ã‡πà‡∏≠‡∏ô popup ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å 1.5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
    }

    handleFileSelect(event) {
        const file = event.target.files[0];
        if (file) {
            this.attachedFiles = [file]; // ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡∏ö‡πÑ‡∏î‡πâ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
            this.renderAttachedFiles();
            this.updateSendButtonState();
        }
    }

    renderAttachedFiles() {
        this.attachedFilesContainer.innerHTML = '';
        if (this.attachedFiles.length > 0) {
            this.attachedFilesContainer.classList.remove('hidden');
            this.attachedFiles.forEach((file, index) => {
                const filePreview = document.createElement('div');
                filePreview.classList.add('flex', 'items-center', 'bg-gray-700', 'text-white', 'px-3', 'py-1', 'rounded-full', 'space-x-2', 'text-sm');
                filePreview.innerHTML = `
                    <span>${file.name}</span>
                    <button class="remove-file-btn text-gray-400 hover:text-white" data-index="${index}">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                `;
                this.attachedFilesContainer.appendChild(filePreview);
            });
            // ‡πÄ‡∏û‡∏¥‡πà‡∏° EventListener ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏ö‡πÑ‡∏ü‡∏•‡πå
            this.attachedFilesContainer.addEventListener('click', (e) => {
                if (e.target.closest('.remove-file-btn')) {
                    const indexToRemove = parseInt(e.target.closest('.remove-file-btn').dataset.index);
                    this.attachedFiles.splice(indexToRemove, 1); // ‡∏•‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å array
                    this.renderAttachedFiles(); // re-render ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI
                    this.updateSendButtonState();
                    if (this.attachedFiles.length === 0) {
                        this.attachedFilesContainer.classList.add('hidden'); // ‡∏ã‡πà‡∏≠‡∏ô container ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏•‡πâ‡∏ß
                    }
                }
            });
        } else {
            this.attachedFilesContainer.classList.add('hidden');
        }
    }
}

// ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Ñ‡∏•‡∏≤‡∏™‡πÄ‡∏°‡∏∑‡πà‡∏≠ DOM ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à
document.addEventListener('DOMContentLoaded', () => {
    new SparkTopoChat();
});
</script>
</body>
</html>
